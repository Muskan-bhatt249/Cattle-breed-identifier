<!doctype html><html><head><meta charset="utf-8"><meta name="viewport"content="width=device-width,initial-scale=1">
<title>Pashu Aadhar</title><link rel="stylesheet" href="../styles/shared.css"></head><body>
<div class="container">
  <div class="card header"><div><div class="h1">Pashu Aadhar</div><div class="small">Register & lookup livestock unique ID</div></div></div>

  <div class="card">
    <div class="form-row">
      <div><label>Owner Name</label><input id="owner"></div>
      <div><label>Phone</label><input id="phone"></div>
      <div><label>Breed</label><input id="breed"></div>
      <div><label>Photo</label><input id="photo" type="file" accept="image/*"></div>
    </div>
    <div style="margin-top:12px" class="row"><button id="regBtn">Register Pashu Aadhar</button><div id="regMsg" class="small"></div></div>

    <div id="lookup" style="margin-top:12px" class="result">
      <label>Lookup by Pashu Aadhar</label><input id="pId"><button id="lookupBtn">Lookup</button>
      <div id="lookupResult" class="small" style="margin-top:8px"></div>
    </div>
  </div>
</div>

<script src="../scripts/shared.js"></script>
<script>
document.getElementById('regBtn').addEventListener('click', async ()=>{
  const payload = {owner: document.getElementById('owner').value, phone: document.getElementById('phone').value, breed: document.getElementById('breed').value};
  // Should be a multipart POST /api/pashu/register -> returns {pashu_id, qr_url}
  try{
    const resp = await postJSON('/api/pashu/register', payload);
    document.getElementById('regMsg').textContent = 'Registered: ' + (resp.pashu_id || 'p_id_not_returned');
  }catch(e){
    document.getElementById('regMsg').textContent = 'Registration mocked';
  }
});

document.getElementById('lookupBtn').addEventListener('click', async ()=>{
  const id = document.getElementById('pId').value.trim();
  if(!id) return;
  try{
    const res = await fetch(`/api/pashu/${encodeURIComponent(id)}`);
    if(!res.ok) throw new Error('not found');
    const data = await res.json();
    document.getElementById('lookupResult').textContent = JSON.stringify(data);
  }catch(e){
    document.getElementById('lookupResult').textContent = 'Not found (mock).';
  }
});
</script>
</body></html>
